# 网页 2.0 

在最开始的时候，互联网还是一个页面检索系统，起初只是被设计用来提供相互链接的页面。当你在浏览器地址栏输入一个地址或者点击页面上的一个链接，一个新的页面就会从服务器上返回并展示在浏览器窗口上。但在 Web 2.0 和 Web 2.0 前期开始，互联网的世界就有了大量的变化。在 Javascript、CSS 和 AJAX(XMLHttpRequest) 的帮助下，网页比起静态页面拥有了更多程序和应用的特性。

本章会把现代的网页（或互联网应用，也就是 Page 2.0、网页 2.0）类比成人类的一生。在介绍完网页 2.0 的每个成长阶段后，本章会大概列举在每个阶段哪些地方可以进行优化。后面的章节则会逐个深入这些优化方法，并且告诉你怎么搭建一个为速度优化的互联网应用。


## 网页 2.0 的一生

让我们一起看下在 **图2.1.** 的时间线，它描述了网页 2.0 一生的各个阶段，并且每个阶段对应了人类成长的关键历程。


*图 2.1. 网页 2.0 的一生*

### 从请求开始

一切都从一个请求开始。人们在浏览器地址栏输入一个 URL 或者点击一个链接，从此刻开始一个网页就准备在服务器中「受孕」。我们会在第三章详细的介绍什么是请求以及请求的过程。

### 生成 HTML 文档

下一步就是服务器「怀孕」整个页面的过程。在互联网初期，这个阶段只是简单地通过服务软件从硬盘中检索请求的静态文档（HTML 文件），并读取其内容。但现在情况则复杂很多，因为大多数网站都使用了服务端编程语言如 PHP、Ruby、Python、Perl 等待去生成动态的 HTML 文档。

服务端编程语言（一般称作服务端脚本）一开始会从某个地方获取部分数据，通常是数据库或者别的互联网服务。然后服务器把数据碎片集中并用一些字符串整合在一起，组成 HTML 代码，这就是一个动态生成的页面。

本书将不准备讨论这部分的优化，因为这个地方不应该去花费太多的时间。

### 开始响应并返回

幸运的是，如果没有什么纷纷扰扰，比如「流产」或 404 什么的，「怀孕」的过程很快就会完成，然后 HTML 文档就会通过 HTTP 响应返回给浏览器。

一个 2.0 版的网页正式诞生了。

### 瀑布流

接下来会进入瀑布流阶段，浏览器会下载页面剩下所需要的资源，如图片、脚本、样式等等。这个阶段会在浏览器触发 onload 事件时结束，此时这个 HTML 文档所引用的所有资源都已经被下载下来。这个阶段大概对应人类的少年时期，最后终于毕业并成为了「页面妹子」[译者注：原名 Ms. Page]。对于页面优化来说，这个阶段是最重要的。本书从第三章开始，将专注于介绍这一阶段的优化手段。

### 完整的页面

onload 事件触发完之后，「页面妹子」开始「安定」阶段下来并继续寻找真正的自己。用专业的术语说就是，在这一阶段脚本（Javascripts）开始执行一些初始化工作，比如在 DOM 元素上绑定事件、添加渐进增强效果、加载跟多的资源或组件、或者异步请求一些额外的数据。

然后页面基本就加载完成了，浏览器上的状态栏停止显示正在下载的资源 URL，标签上的菊花停止转动，鼠标图案不再是忙碌中，用户终于可以<s>挑逗妹子</s>跟页面进行交互了。这一阶段也可以看成我们的「页面妹子」从敏感词和西欧背包旅游回来，找了一份稳定的工作，买了一个烧烤炉，准备结婚。[译者注：我也不知道为什么要在结婚前烧烤炉]

### 用户开始交互行为

生活继续进行，这一阶段用户会跟页面产生交互行为。有些网页大部分是静态和平凡的，比如一个新闻或者一篇博客，这些页面让人感到兴奋的地方可能就是旁边那个广告切换了那么一下。不过，其它网页（想象下网页邮箱）则是一直<s>上下上下进进出出</s>上传和下载，不断在获取新数据，更新页面，永不停息。

### 终结，和下一个请求的来临

结局总会来临，当下一个请求产生前一切都会结束。用户的点击一旦离开了页面，发起了新的请求，我们的「页面婆婆」会在浏览器的 onunload 事件触发后安息。


## 页面什么时候才是「加载完成」？




















